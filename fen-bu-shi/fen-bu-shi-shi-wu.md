# 分布式事务
- XA协议(两阶段提交、三阶段提交)


- 可靠消息最终一致（异步确何型）
- TCC （两阶段型、补偿型）
- 最大努力通知（非可靠消息 、定期校对）


## XA协议两阶段提交
#### 角色
> 中心单点协调者、分节点多参与者

#### 流程
> 第一阶段：协调者通知各参与者准备，各参与者锁住资源，执行操作并记入undo、redo，等待协调者 第二阶段通知后提交
第二阶段：协调者收到所有参与者发回的反馈信息，如果都是Done则通知 各参与者 提交事务；如果不都是Done则通知 各参与者回滚事务；

- 第一阶段
 ![](/assets/640.webp)

- 第二阶段
![](/assets/641.webp)


#### 不足
- 性能问题
- 协调者单点故障问题
- 丢失消息导致的不一致问题


#### 性能问题
第一阶段后 各参与者 锁住资源，执行操作并记入undo、redo等待提交

#### 协调者单点故障问题

#### 丢失消息导致的不一致问题






























# 分布式可靠消息

![](/assets/hello.PNG)

有两个问题：1.消息状态确认 2.消息恢复
轮询从业务方读取状态并更新


![](/assets/shiwu.PNG)

我的文档：第40： 2017年7月最新微服务架构的分布式事务解决方案价值1399


# 分布式最大努力型
也就是将可靠消息的 （请求发送、确认发送、取消发送）部分 替换为 在业务处理服务的本地数据库消息表中，其他消息确认系统，和消息恢复（定时检查）不变